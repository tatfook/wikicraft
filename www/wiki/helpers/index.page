<?npl
--[[
Title: load helper file
Author: wuxiangan
Date: 2017/3/13
]]

NPL.load("(gl)script/apps/WebServer/mem_cache.lua")
mem_cache = commonlib.gettable("WebServer.mem_cache"):GetInstance()

log(mem_cache)

-- 初始化数据库
function init_db()
	if(db) then
		return;
	end

	local pos = string.find(WIKI_ROOT,"/")
	local name = WIKI_ROOT
	if pos then
		name = string.sub(WIKI_ROOT, 1, pos-1)
	end

	db = TableDatabase:new():connect("database/" .. name .. '/', function() end);
end

-- 初始wiki module
function init_wiki_module()
	local isWebServerStart = mem_cache:get("isWebServerStart")
	if not isWebServerStart then
		mem_cache:set("isWebServerStart", true)
		include_once(WIKI_ROOT .. "helpers/wiki_module.page")
	end
end

-- 获取bust version
function getBustVersion()
	local version = mem_cache:get("bustVersion")
	if not version then 
		version = os.time()
		mem_cache:set("bustVersion", version)
	end

	return version
end

function init()
	init_db()
	init_wiki_module()
end

init()
