<?npl
--[[
Title: download the zip form github
Author: big
Date: 2016/10/9
Desc: 
]]

NPL.load("(gl)script/ide/System/Plugins/PluginManager.lua");

addheader('Access-Control-Allow-Origin', '*'); 

local PluginManager = commonlib.gettable("System.Plugins.PluginManager");
local manager = PluginManager.CreateGetInstance("Paracraft");
--echo(manager:GetLoader():RebuildModuleList())  --> list of installed plugins
--manager:GetLoader():LoadAllPlugins() --> load plugins, see PluginLoader for details

if(is_ajax()) then
	add_action(
		'wp_ajax_downloadzip',
		function()
			local url = request:get('url');
			url = 'https://github.com/LiXizhi/ParaCraftSDK.git';
			
			manager:GetLoader():InstallFromUrl(
				url, 
				function(bSucceed, msg)
					resume();
					log({"msg",msg}); 
				end
			);

			yield();
		end
	);

	add_action(
		'',
		function()
			


		end
	)

	add_action(
		'wp_ajax_GetCurrentDownload',
		function()
			wp_send_json(manager:GetLoader():GetDownloadInfo());
		end
	);

	return;
end


wp_enqueue_script("jqueryui", "/wp-includes/js/jquery/jquery-ui.min.js"); 
wp_enqueue_script("bootstrap", "/wp-includes/js/bootstrap/js/bootstrap.min.js");
wp_enqueue_script("angular", "/wp-includes/js/angular/angular.min.js");
wp_enqueue_script("angular-ui", "/wp-includes/js/angular/ui-bootstrap-tpls-1.3.3.min.js");
wp_enqueue_script("localInstallController","/wp-includes/js/plugin/localInstallController.js")
wp_enqueue_style("plugin", "/wp-admin/css/plugin.css");
PAGE_NO_SIDE_BAR = true;
?>
<div class="plugin" ng-app="plugin" ng-controller="localInstallController">
	<h1>
        Do you want to install the following <br/> plugin to your local computer?
	</h1>

    <div class="infor-details">
        <div class="item">
            <label>Package name</label>
            <div>{{projectName}}</div>
        </div>
        <div class="item">
            <label>Author</label>
            <div>{{author}}</div>
        </div>
        <div class="item">
            <label>Version</label>
            <div>{{version}}</div>
        </div>
    </div>
    
    <div class="button">
        <button class="start" ng-click="install()">Yes</button>
        <button class="process" disabled="disabled"></button>
        <span> Press close button at right top corner</span>
        <!--<button ng-click="cancel()">Cancel</button>-->
    </div>
</div>