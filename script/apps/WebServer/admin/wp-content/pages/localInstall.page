<?npl
--[[
Title: download the zip form github
Author: big
Date: 2016/10/9
Desc: 
]]

addheader('Access-Control-Allow-Origin', '*'); 

NPL.load("(gl)script/ide/System/Plugins/PluginLoader.lua");
local PluginLoader = commonlib.gettable("System.Plugins.PluginLoader");
local loader = PluginLoader:new();
log({"loader",loader}); 
--NPL.load("(gl)script/ide/System/Plugins/PluginManager.lua");
--local PluginManager = commonlib.gettable("System.Plugins.PluginManager");
--local manager = PluginManager.CreateGetInstance("Paracraft");

--echo(manager:GetLoader():RebuildModuleList())  --> list of installed plugins
--manager:GetLoader():LoadAllPlugins() --> load plugins, see PluginLoader for details


if(is_ajax()) then
	add_action('wp_ajax_downloadzip',function()
		local url = request:get('url');

		log({"url",url});

		loader:InstallFromZipBinary("test", "some data here");
		loader:InstallFromUrl(
			"https://github.com/tatfook/NPLCAD/archive/master.zip", 
			function(bSucceed, msg)
				log({"msg",msg}); 
			end
		);

		--echo(manager:GetLoader():RebuildModuleList());

		--loader = loader:init(manager, "Mod/");
		--local list = loader:RebuildModuleList()
		--loader:LoadAllPlugins();

	end);
	return;
end


wp_enqueue_script("jqueryui", "/wp-includes/js/jquery/jquery-ui.min.js"); 
wp_enqueue_script("bootstrap", "/wp-includes/js/bootstrap/js/bootstrap.min.js");
wp_enqueue_script("angular", "/wp-includes/js/angular/angular.min.js");
wp_enqueue_script("angular-ui", "/wp-includes/js/angular/ui-bootstrap-tpls-1.3.3.min.js");
wp_enqueue_script("localInstallController","/wp-includes/js/plugin/localInstallController.js")
wp_enqueue_style("plugin", "/wp-admin/css/plugin.css");
PAGE_NO_SIDE_BAR = true;
?>
<div class="plugin" ng-app="plugin" ng-controller="localInstallController">
	<h1>
        Do you want to install the following <br/> plugin to your local computer?
	</h1>

    <div class="infor-details">
        <div class="item">
            <label>Package name</label>
            <div>displayName</div>
        </div>
        <div class="item">
            <label>Author</label>
            <div>version</div>
        </div>
        <div class="item">
            <label>Version</label>
            <div>projectUpdate</div>
        </div>
    </div>
    
    <div class="button">
        <button ng-click="install()">Yes</button>
        <button ng-click="cancel()">Cancel</button>
    </div>
</div>